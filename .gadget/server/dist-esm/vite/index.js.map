{"version":3,"sources":["/var/gadget/codegen/framework-1742065326854-RUN6wP/src/vite/index.ts"],"sourcesContent":["import { getHtmlTags, getViteConfig } from \"./helpers.js\";\nimport { GadgetPluginOptions } from \"./types.js\";\nimport { patchOverlay } from \"../core/errors/overlay.js\";\n\n/**\n * Vite plugin that is used to configure the Vite build process for the Gadget application.\n */\nexport const gadget = (options?: GadgetPluginOptions) => {\n  \n\n  /**\n   * Available frontend type:\n   * - \"remix\"\n   * - \"react-router-framework\"\n   * - \"vite\"\n   */\n  let frontendType: any;\n  let command: \"serve\" | \"build\";\n\n  return {\n    name: \"gadget-vite-plugin\",\n    config: async (config: any, env: any) => {\n      \n        const result = await getViteConfig(config, env, {\n          plugin: options,\n          params: {\n            assetsBucketDomain: \"app-assets.gadget.dev\",\n            applicationId: \"217028\",\n            productionEnvironmentId: \"436384\",\n            developmentEnvironmentVariables: {\"GADGET_APP\":\"shapesplosion\",\"GADGET_ENV\":\"development\",\"GADGET_PUBLIC_APP_SLUG\":\"shapesplosion\",\"GADGET_PUBLIC_APP_ENV\":\"development\"},\n            productionEnvironmentVariables: {\"GADGET_APP\":\"shapesplosion\",\"GADGET_ENV\":\"production\",\"GADGET_PUBLIC_APP_SLUG\":\"shapesplosion\",\"GADGET_PUBLIC_APP_ENV\":\"production\"},\n          },\n        });\n\n        frontendType = result.type;\n        command = result.command;\n\n        return result.config;\n      \n    },\n    transformIndexHtml: {\n      order: \"pre\",\n      handler: (html: string, { server }: any) => {\n        \n        if(frontendType !== \"vite\") {\n          return [];\n        }\n\n        const tags = getHtmlTags({\n          hasAppBridgeV4: false,\n          hasBigCommerceConnection: false,\n          assetsDomain: \"assets.gadget.dev\",\n          hasShopifyConnection: false,\n        }, !!server);\n\n        return tags;\n        \n      }\n    },\n    transform(src: any, id: any, opts: any) {\n      \n\n      if(frontendType !== \"vite\" && command === \"serve\" && (id.endsWith(\"/web/root.tsx\") || id.endsWith(\"/web/root.jsx\"))) {\n        return {\n          code: src + `\nif(typeof window !== \"undefined\") {\n  const script = window.document.createElement(\"script\");\n  script.src = \"https://assets.gadget.dev/assets/devHarness.min.js\";\n  window.document.head.appendChild(script);\n\n\n}\n`\n        }\n      }\n    }\n  } as any;\n}\n"],"names":["getHtmlTags","getViteConfig","gadget","options","frontendType","command","name","config","env","result","plugin","params","assetsBucketDomain","applicationId","productionEnvironmentId","developmentEnvironmentVariables","productionEnvironmentVariables","type","transformIndexHtml","order","handler","html","server","tags","hasAppBridgeV4","hasBigCommerceConnection","assetsDomain","hasShopifyConnection","transform","src","id","opts","endsWith","code"],"mappings":"AAAA,SAASA,WAAW,EAAEC,aAAa,QAAQ,eAAe;AAI1D;;CAEC,GACD,OAAO,MAAMC,SAAS,CAACC;IAGrB;;;;;GAKC,GACD,IAAIC;IACJ,IAAIC;IAEJ,OAAO;QACLC,MAAM;QACNC,QAAQ,OAAOA,QAAaC;YAExB,MAAMC,SAAS,MAAMR,cAAcM,QAAQC,KAAK;gBAC9CE,QAAQP;gBACRQ,QAAQ;oBACNC,oBAAoB;oBACpBC,eAAe;oBACfC,yBAAyB;oBACzBC,iCAAiC;wBAAC,cAAa;wBAAgB,cAAa;wBAAc,0BAAyB;wBAAgB,yBAAwB;oBAAa;oBACxKC,gCAAgC;wBAAC,cAAa;wBAAgB,cAAa;wBAAa,0BAAyB;wBAAgB,yBAAwB;oBAAY;gBACvK;YACF;YAEAZ,eAAeK,OAAOQ,IAAI;YAC1BZ,UAAUI,OAAOJ,OAAO;YAExB,OAAOI,OAAOF,MAAM;QAExB;QACAW,oBAAoB;YAClBC,OAAO;YACPC,SAAS,CAACC,MAAc,EAAEC,MAAM,EAAO;gBAErC,IAAGlB,iBAAiB,QAAQ;oBAC1B,OAAO,EAAE;gBACX;gBAEA,MAAMmB,OAAOvB,YAAY;oBACvBwB,gBAAgB;oBAChBC,0BAA0B;oBAC1BC,cAAc;oBACdC,sBAAsB;gBACxB,GAAG,CAAC,CAACL;gBAEL,OAAOC;YAET;QACF;QACAK,WAAUC,GAAQ,EAAEC,EAAO,EAAEC,IAAS;YAGpC,IAAG3B,iBAAiB,UAAUC,YAAY,WAAYyB,CAAAA,GAAGE,QAAQ,CAAC,oBAAoBF,GAAGE,QAAQ,CAAC,gBAAe,GAAI;gBACnH,OAAO;oBACLC,MAAMJ,MAAM,CAAC;;;;;;;;AAQvB,CAAC;gBACO;YACF;QACF;IACF;AACF,EAAC"}